# **Session 3 - Partie 1 : ModÃ©lisation des donnÃ©es et relations**  

---

## **ğŸ¯ Objectifs pÃ©dagogiques**  

Ã€ la fin de cette session, vous serez capable de :  
âœ… Comprendre les principes de la modÃ©lisation des donnÃ©es en MongoDB.  
âœ… DiffÃ©rencier les approches **embedding** et **referencing**.  
âœ… ModÃ©liser des relations **1-N**, **N-N** et choisir la meilleure approche.  
âœ… Optimiser la structure des collections pour amÃ©liorer les performances.  

---

## **ğŸ“š Contenu du cours**  

## **1ï¸âƒ£ Introduction Ã  la modÃ©lisation des donnÃ©es en MongoDB**  

Contrairement aux bases relationnelles (SQL), MongoDB permet une modÃ©lisation **souple et dynamique**.  
Il existe deux **approches principales** pour gÃ©rer les relations entre les donnÃ©es :  

ğŸ”¹ **Embedding (donnÃ©es imbriquÃ©es)** â†’ Stocker les donnÃ©es liÃ©es **dans le mÃªme document**.  
ğŸ”¹ **Referencing (rÃ©fÃ©rencement entre documents)** â†’ Lier les donnÃ©es avec un **ObjectId**.  

ğŸ“Œ **Bonnes pratiques** :  
âœ” Embedding pour **les donnÃ©es souvent lues ensemble**.  
âœ” Referencing pour **Ã©viter la redondance et optimiser les mises Ã  jour**.  

---

## **2ï¸âƒ£ ModÃ©lisation des relations en MongoDB**  

### **ğŸ”¹ Relation 1-N (One-to-Many)**  

#### âœ… **Approche Embedding (donnÃ©es imbriquÃ©es)**  
Cas oÃ¹ une **relation est faible** et les donnÃ©es sont **souvent utilisÃ©es ensemble**.  
Exemple : Un **utilisateur** avec ses **adresses**.  

```json
{
  "_id": ObjectId("602d2149e773f2a3990b47f5"),
  "nom": "Alice Dupont",
  "email": "alice@email.com",
  "adresses": [
    { "rue": "10 rue de Paris", "ville": "Paris", "code_postal": "75001" },
    { "rue": "5 avenue Lyon", "ville": "Lyon", "code_postal": "69003" }
  ]
}
```
ğŸ“Œ **Avantages** :  
âœ” Lecture rapide â†’ une seule requÃªte suffit (`findOne()`).  
âœ” IdÃ©al si le nombre dâ€™Ã©lÃ©ments est **limitÃ©** et rarement mis Ã  jour.  

ğŸ“Œ **InconvÃ©nients** :  
âŒ Risque de **dupliquer** les donnÃ©es si lâ€™info est partagÃ©e par plusieurs documents.  
âŒ Si une adresse change, **toutes les occurrences** doivent Ãªtre mises Ã  jour.  

#### âœ… **Approche Referencing (documents liÃ©s)**  
Cas oÃ¹ les donnÃ©es sont **rÃ©utilisÃ©es** ou **modifiÃ©es frÃ©quemment**.  

**Collection `utilisateurs`**  
```json
{
  "_id": ObjectId("602d2149e773f2a3990b47f5"),
  "nom": "Alice Dupont",
  "email": "alice@email.com",
  "adresses": [ ObjectId("603d2149e773f2a3990b47a1"), ObjectId("603d2149e773f2a3990b47a2") ]
}
```
**Collection `adresses`**  
```json
{
  "_id": ObjectId("603d2149e773f2a3990b47a1"),
  "rue": "10 rue de Paris",
  "ville": "Paris",
  "code_postal": "75001"
}
```
ğŸ“Œ **Avantages** :  
âœ” Moins de duplication de donnÃ©es.  
âœ” Les modifications sont plus **faciles** et plus efficaces.  

ğŸ“Œ **InconvÃ©nients** :  
âŒ Il faut faire **deux requÃªtes** (`find()` puis `lookup`).  

---

### **ğŸ”¹ Relation N-N (Many-to-Many)**  

Cas typique : **Utilisateurs et Groupes**.  
Un utilisateur peut Ãªtre **dans plusieurs groupes** et un groupe peut avoir **plusieurs utilisateurs**.  

#### âœ… **Approche avec tableau dâ€™IDs (recommandÃ©e)**  
Collection `utilisateurs` :  
```json
{
  "_id": ObjectId("602d2149e773f2a3990b47f5"),
  "nom": "Alice Dupont",
  "groupes": [ ObjectId("603d2149e773f2a3990b47a3"), ObjectId("603d2149e773f2a3990b47a4") ]
}
```
Collection `groupes` :  
```json
{
  "_id": ObjectId("603d2149e773f2a3990b47a3"),
  "nom": "DÃ©veloppeurs",
  "membres": [ ObjectId("602d2149e773f2a3990b47f5"), ObjectId("602d2149e773f2a3990b47f6") ]
}
```
ğŸ“Œ **Explication** :  
âœ” On stocke les **rÃ©fÃ©rences mutuelles** pour relier les collections.  
âœ” Utilisation de `$lookup` pour faire une jointure si nÃ©cessaire.  

#### âœ… **Jointure avec `$lookup`**  
```sh
db.utilisateurs.aggregate([
  {
    "$lookup": {
      "from": "groupes",
      "localField": "groupes",
      "foreignField": "_id",
      "as": "details_groupes"
    }
  }
])
```
ğŸ“Œ **Explication** :  
âœ” Associe chaque utilisateur aux **informations complÃ¨tes** de ses groupes.  

---

## **3ï¸âƒ£ Optimisation et bonnes pratiques**  

âœ” **Utiliser Embedding** pour **les donnÃ©es rarement modifiÃ©es** et **souvent lues ensemble**.  
âœ” **Utiliser Referencing** si les donnÃ©es sont **rÃ©utilisÃ©es** dans plusieurs documents.  
âœ” **Ne pas imbriquer trop profondÃ©ment** â†’ risque de **documents trop volumineux** (> 16MB).  
âœ” **Indexation des champs de rÃ©fÃ©rence** pour amÃ©liorer les performances (`createIndex({ groupes: 1 })`).  

---

## **4ï¸âƒ£ Utilisation de MongoDB Compass pour la modÃ©lisation**  

### **ğŸ”¹ Explorer les relations dans Compass**  
1ï¸âƒ£ Ouvrir MongoDB Compass.  
2ï¸âƒ£ SÃ©lectionner une **base de donnÃ©es** et une **collection**.  
3ï¸âƒ£ Ajouter des documents avec des rÃ©fÃ©rences (`ObjectId`).  
4ï¸âƒ£ Utiliser la **vue JSON** pour visualiser les relations.  

### **ğŸ”¹ Tester une jointure avec `$lookup`**  
1ï¸âƒ£ Aller dans **Aggregations**.  
2ï¸âƒ£ Ajouter un **stage `$lookup`** pour relier les collections.  
3ï¸âƒ£ VÃ©rifier les rÃ©sultats et optimiser la requÃªte.  

---

## **ğŸ› ï¸ ActivitÃ©s pratiques**  

### **Exercice 1 : CrÃ©ation dâ€™une base de gestion de commandes**  
ğŸ“Œ **Objectif** : ModÃ©liser une base MongoDB pour un site e-commerce.  

1ï¸âƒ£ **CrÃ©er une collection `clients`** avec des **informations de base** (nom, email, tÃ©lÃ©phone).  
2ï¸âƒ£ **CrÃ©er une collection `commandes`** avec des rÃ©fÃ©rences vers les clients (`client_id`).  
3ï¸âƒ£ **CrÃ©er une collection `produits`** et stocker les produits commandÃ©s dans `commandes` (embedding ou referencing ?).  
4ï¸âƒ£ **Utiliser `$lookup`** pour afficher une commande avec les dÃ©tails du client et des produits.  
5ï¸âƒ£ **Optimiser la structure** et discuter du choix de modÃ©lisation.  

---

## **ğŸ“– Questions de rÃ©vision**  

âœ” Quelle est la diffÃ©rence entre **embedding** et **referencing** en MongoDB ?  
âœ” Quand utiliser une relation **1-N** avec embedding ? Quand privilÃ©gier referencing ?  
âœ” Comment stocker une relation **N-N** efficacement en MongoDB ?  
âœ” Pourquoi `$lookup` est-il utile pour gÃ©rer les relations entre collections ?  
