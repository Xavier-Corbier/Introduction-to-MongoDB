# **Session 2 - Partie 1 : CRUD dans MongoDB**  

---

## **ğŸ¯ Objectifs pÃ©dagogiques**  

Ã€ la fin de cette session, vous serez capable de :  
âœ… InsÃ©rer des documents dans une collection.  
âœ… Lire des donnÃ©es avec des filtres et projections.  
âœ… Mettre Ã  jour des documents existants.  
âœ… Supprimer des documents dâ€™une collection.  
âœ… Comprendre les diffÃ©rences entre `insertOne()`, `insertMany()`, `findOne()`, `updateOne()`, etc.  

---

## **ğŸ“š Contenu du cours**  

## **1ï¸âƒ£ Quâ€™est-ce que le CRUD ?**  

CRUD est un acronyme reprÃ©sentant les **quatre opÃ©rations fondamentales** utilisÃ©es pour manipuler des donnÃ©es :  
- **Create** â†’ Ajouter des documents (`insertOne()`, `insertMany()`).  
- **Read** â†’ Lire des documents (`find()`, `findOne()`).  
- **Update** â†’ Modifier des documents (`updateOne()`, `updateMany()`).  
- **Delete** â†’ Supprimer des documents (`deleteOne()`, `deleteMany()`).  

> ğŸ’¡ En MongoDB, les documents sont manipulÃ©s directement dans les **collections**, contrairement aux bases SQL oÃ¹ on manipule des lignes dans des tables.  

---

## **2ï¸âƒ£ CrÃ©ation de documents (`C` de CRUD)**  

### **ğŸ”¹ InsÃ©rer un document unique (`insertOne()`)**  
```sh
db.produits.insertOne({
  "nom": "Ordinateur Portable",
  "prix": 1200,
  "categorie": "Informatique",
  "stock": 50
})
```
ğŸ“Œ **Explication** :  
âœ” `insertOne()` ajoute un document Ã  la collection `produits`.  
âœ” Un champ `_id` unique est gÃ©nÃ©rÃ© automatiquement.  

### **ğŸ”¹ InsÃ©rer plusieurs documents (`insertMany()`)**  
```sh
db.produits.insertMany([
  { "nom": "Souris", "prix": 25, "categorie": "Informatique", "stock": 200 },
  { "nom": "Clavier", "prix": 45, "categorie": "Informatique", "stock": 150 },
  { "nom": "Ã‰cran", "prix": 250, "categorie": "Informatique", "stock": 80 }
])
```
ğŸ“Œ **Explication** :  
âœ” `insertMany()` permet dâ€™insÃ©rer plusieurs documents en une seule requÃªte.  
âœ” Cela amÃ©liore les performances en rÃ©duisant le nombre dâ€™opÃ©rations.  

### **ğŸ”¹ VÃ©rifier lâ€™insertion**  
```sh
db.produits.find().pretty()
```
---

## **3ï¸âƒ£ Lecture des documents (`R` de CRUD)**  

### **ğŸ”¹ Lire tous les documents dâ€™une collection (`find()`)**  
```sh
db.produits.find()
```
ğŸ“Œ **Explication** :  
âœ” Retourne tous les documents de la collection `produits`.  

### **ğŸ”¹ Lire un document unique (`findOne()`)**  
```sh
db.produits.findOne({ "nom": "Souris" })
```
ğŸ“Œ **Explication** :  
âœ” Retourne **le premier document** correspondant au critÃ¨re.  

### **ğŸ”¹ Filtrer les rÃ©sultats (`find() avec conditions`)**  
```sh
db.produits.find({ "prix": { "$gt": 100 } })  # Produits dont le prix est > 100
```
ğŸ“Œ **Explication** :  
âœ” `$gt` signifie **greater than** (supÃ©rieur Ã ).  
âœ” Dâ€™autres opÃ©rateurs existent : `$lt` (infÃ©rieur), `$eq` (Ã©gal), `$ne` (diffÃ©rent), `$in` (dans une liste), etc.  

### **ğŸ”¹ SÃ©lectionner uniquement certains champs (projection)**  
```sh
db.produits.find({}, { "nom": 1, "prix": 1, "_id": 0 })
```
ğŸ“Œ **Explication** :  
âœ” Affiche uniquement les champs `nom` et `prix`.  
âœ” `_id: 0` permet de cacher lâ€™`_id`.  

---

## **4ï¸âƒ£ Mise Ã  jour des documents (`U` de CRUD)**  

### **ğŸ”¹ Modifier un seul document (`updateOne()`)**  
```sh
db.produits.updateOne(
  { "nom": "Souris" },
  { $set: { "prix": 30 } }
)
```
ğŸ“Œ **Explication** :  
âœ” `$set` permet de modifier un champ existant.  
âœ” Seul le **premier** document correspondant au filtre est mis Ã  jour.  

### **ğŸ”¹ Modifier plusieurs documents (`updateMany()`)**  
```sh
db.produits.updateMany(
  { "categorie": "Informatique" },
  { $inc: { "stock": 10 } }
)
```
ğŸ“Œ **Explication** :  
âœ” `$inc` permet **dâ€™incrÃ©menter** la valeur dâ€™un champ.  
âœ” Ici, on **ajoute 10 unitÃ©s de stock** Ã  tous les produits en "Informatique".  

---

## **5ï¸âƒ£ Suppression de documents (`D` de CRUD)**  

### **ğŸ”¹ Supprimer un document (`deleteOne()`)**  
```sh
db.produits.deleteOne({ "nom": "Clavier" })
```
ğŸ“Œ **Explication** :  
âœ” Supprime **le premier document** correspondant au critÃ¨re.  

### **ğŸ”¹ Supprimer plusieurs documents (`deleteMany()`)**  
```sh
db.produits.deleteMany({ "categorie": "Informatique" })
```
ğŸ“Œ **Explication** :  
âœ” Supprime **tous** les documents de la catÃ©gorie "Informatique".  

---

## **6ï¸âƒ£ Utilisation de MongoDB Compass pour le CRUD**  

### **ğŸ”¹ InsÃ©rer des documents**  
1ï¸âƒ£ Ouvrir MongoDB Compass et se connecter Ã  **mongodb://localhost:27017**.  
2ï¸âƒ£ SÃ©lectionner une base de donnÃ©es et une collection.  
3ï¸âƒ£ Cliquer sur **"INSERT DOCUMENT"** et ajouter un document JSON.  

### **ğŸ”¹ Lire les documents**  
1ï¸âƒ£ Aller dans lâ€™onglet **"Documents"**.  
2ï¸âƒ£ Utiliser le champ **FILTER** pour rechercher `{ "prix": { "$gt": 100 } }`.  
3ï¸âƒ£ Cliquer sur **"FIND"** pour voir les rÃ©sultats.  

### **ğŸ”¹ Mettre Ã  jour un document**  
1ï¸âƒ£ SÃ©lectionner un document et cliquer sur **"Edit Document"**.  
2ï¸âƒ£ Modifier les champs et enregistrer.  

### **ğŸ”¹ Supprimer un document**  
1ï¸âƒ£ SÃ©lectionner un document et cliquer sur **"Delete"**.  
2ï¸âƒ£ Confirmer la suppression.  

---

## **ğŸ› ï¸ ActivitÃ©s pratiques**  

### **Exercice 1 : Manipulation du CRUD dans MongoDB**  
ğŸ“Œ **Objectif** : GÃ©rer un catalogue de livres dans MongoDB.  

1ï¸âƒ£ **CrÃ©er une base `librairie` et une collection `livres`**.  
2ï¸âƒ£ **InsÃ©rer 3 livres** avec les champs : `titre`, `auteur`, `prix`, `disponible`.  
3ï¸âƒ£ **Rechercher un livre prÃ©cis** (`findOne()`).  
4ï¸âƒ£ **Lister tous les livres coÃ»tant plus de 20â‚¬** (`find()` avec `$gt`).  
5ï¸âƒ£ **Augmenter le prix de tous les livres de 5â‚¬** (`updateMany()` avec `$inc`).  
6ï¸âƒ£ **Supprimer un livre prÃ©cis** (`deleteOne()`).  
7ï¸âƒ£ **Supprimer tous les livres dâ€™un auteur spÃ©cifique** (`deleteMany()`).  

---

## **ğŸ“– Questions de rÃ©vision**  

âœ” Quelle est la diffÃ©rence entre `insertOne()` et `insertMany()` ?  
âœ” Comment lire un document spÃ©cifique dans MongoDB ?  
âœ” Quels sont les opÃ©rateurs dâ€™update les plus courants (`$set`, `$inc`â€¦) ?  
âœ” Quelle est la diffÃ©rence entre `deleteOne()` et `deleteMany()` ?  
